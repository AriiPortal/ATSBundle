title:          Sauvegardes Oracle
description:    RÃ©capitulatif des sauvegardes Oracle par instance
header:         DESCRIPTION,STATUS(status),LAST_START(timestamp),LAST_END(timestamp),DURATION(duration),PLANNED_END(timestamp),DELAY(duration),NEXT_START(timestamp),HOST,STANDBY,JOB_NAME
icon:           database
sql:
    oracle: |
        select 
            JOB_NAME,STATUS,DESCRIPTION,LAST_START,LAST_END,LAST_END,NEXT_START,LAST_END - LAST_START as DURATION,
            LAST_START+AVG_RUN_TIME as PLANNED_END,
            LAST_END - (LAST_START+AVG_RUN_TIME) as DELAY,
            EXIT_CODE,
            'ORA.'||SUBSTR(JOB_NAME,6,INSTR(JOB_NAME,'.',6,1)-6)||'.PRIMARY.HOST' as GLO_NAME,p.VALUE as HOST,s.VALUE as STANDBY
        from UJO_JOBST j
            left join UJO_AVG_JOB_RUNS a
                on j.JOID=a.JOID
            left join UJO_GLOB p
                on 'ORA.'||SUBSTR(JOB_NAME,6,INSTR(JOB_NAME,'.',6,1)-6)||'.PRIMARY.HOST'=p.GLO_NAME
            left join UJO_GLOB s
                on 'ORA.'||SUBSTR(JOB_NAME,6,INSTR(JOB_NAME,'.',6,1)-6)||'.STANDBY.HOST'=s.GLO_NAME
        where   ((JOB_NAME like 'ORA%.BOX.%') and  (BOX_JOID=0))
                or ((JOB_NAME like 'ORA%.%.JOB.%') and (STATUS in (5,6,7,10,11,12,13,14,15)))
        order by NEXT_START